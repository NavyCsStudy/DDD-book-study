## 9.1 도메인 모델과 경계

<img width="730" height="296" alt="Image" src="https://github.com/user-attachments/assets/a63b745a-b0bd-40e4-b9b1-817bc5cf7a9c" />

- 하위 도메인마다 같은 용어라도 의미가 다르거나 같은 대상이라도 지칭하는 용어가 다를 수 있다.
- 그렇기 때문에 한 개의 모델로 모든 하위 도메인을 표현하는 것이 아니라, **하위 도메인마다 모델을 만들어야 한다.**
- **각 모델은 명시적으로 구분되는 경계를 가져서 섞이지 않도록** 해야 한다.
    - 이러한 경계를 바운디드 컨텍스트라고 한다.

## 9.2 바운디드 컨텍스트

- 바운디드 컨텍스트는 모델의 경계를 결정하며, 논리적으로 한 개의 모델을 갖는다.
- 용어를 기준으로 구분한다.
- **실제로 사용자에게 기능을 제공하는 물리적 시스템**으로 도메인 모델은 이 바운디드 컨텍스트 안에서 도메인을 구현한다.
- 이상적으로 하위 도메인과 바운디드 컨텍스트가 일대일 관계를 가지면 좋겠지만 현실은 그렇지 않을 때가 많다.
    - 기업의 팀 조직 구조에 따라 결정되기도 한다.
    - 용어를 명확하게 구분하지 못해 두 하위 도메인을 하나의 바운디드 컨텍스트에서 구현하기도 한다.
- 여러 하위 도메인을 하나의 바운디드 컨텍스트에서 개발할 때 주의할 점은 하위 도메인의 모델이 섞이지 않도록 하는 것이다.
    - 전체 하위 도메인을 위한 단일 모델을 만들고 싶은 유혹에 빠지기 쉽다. → 도메인 모델이 개별 하위 도메인을 제대로 반영하지 못해서 하위 도메인 별로 기능을 확장하기 어려워 진다.
- 비록 한 개의 바운디드 컨텍스트가 여러 하위 도메인을 포함하더라도 하위 도메인마다 구분되는 패키지를 갖도록 구현해서 간접적으로 바운디드 컨텍스트를 갖는 효과를 낼 수 있다.
    
    <img width="977" height="365" alt="Image" src="https://github.com/user-attachments/assets/61b42c2d-f0b3-4e21-b773-6ad82442ef32" />
    
- 바운디드 컨텍스트는 구현하는 하위 도메인에 알맞는 모델을 포함한다.
    - 같은 사용자라 하더라도 주문 바운디드 컨텍스트와 회원 바운디드 컨텍스트가 갖는 모델이 달라진다.
    
    <img width="1337" height="673" alt="Image" src="https://github.com/user-attachments/assets/4daeefea-331f-45a3-9b47-a25e09d23007" />image.png
    

## 9.3 바운디드 컨텍스트 구현

- 바운디드 컨텍스트는 도메인 기능을 사용자에게 제공하는 데 필요한 표현 영역, 응용 서비스, 인프라스트럭처 영역을 모두 포함한다. (+ DB 스키마, 테이블)
- 모든 바운디드 컨텍스트를 반드시 도메인 주도로 개발할 필요는 없다.
    - ex) 상품의 리뷰는 복잡한 도메인 로직을 갖지 않기 때문에 CRUD 방식으로 구현해도 된다.
    
    <img width="848" height="610" alt="Image" src="https://github.com/user-attachments/assets/9f27f74b-e826-46d7-abe3-b12d50bda1f9" />
    
- 한 바운디드 컨텍스트에서 두 방식을 혼합해서 사용할 수도 있다.
    - ex) CQRS 패턴 → 상태 변경과 관련된 기능은 도메인 모델 기반으로 구현하고 조회 기능은 서비스-DAO를 이용해서 구현할 수 있다.
    
    <img width="720" height="625" alt="Image" src="https://github.com/user-attachments/assets/4a05aeba-6573-48d2-8932-7f90fac5e0a9" />
    
- 각 바운디드 컨텍스트는 서로 다른 구현 기술을 사용할 수도 있다.

## 9.4 바운디드 컨텍스트 간 통합

- 카탈로그 바운디드 컨텍스트와 추천 기능 바운디드 컨텍스트가 있다고 하자
    - 이때 ‘사용자가 제품 상세 페이지를 볼 때, 보고 있는 상품과 유사한 상품 목록을 하단에 보여준다’는 요구사항이 있으며, 두 바운디드 컨텍스트 간 통합이 발생한다.
- 카탈로그 컨텍스트와 추천 컨텍스트의 도메인 모델은 다르다.
    - 카탈로그는 제품을 중심으로, 추천은 추천 연산을 위한 모델을 구현한다.
- 카탈로그 시스템은 수천 시스템으로부터 추천 데이터를 받아오지만, 카탈로그 시스템에서는 추천의 도메인 모델을 사용하는 것이 아니라 카탈로그 도메인 모델을 사용해서 추천 상품을 표현해야 한다.
    
    <img width="1298" height="920" alt="Image" src="https://github.com/user-attachments/assets/b07d26c6-10dd-4a62-a524-c5d4e943abd7" />
    
- 추천 시스템의 API는 카탈로그 도메인 모델과 일치하지 않는 데이터를 제공할 것이기 때문에 RecSystemClient는 REST API로부터 데이터를 읽어와 카탈로그 도메인에 맞는 상품 모델로 변환한다.
- REST API를 직접 호출하는 것은 두 바운디드 컨텍스트를 직접 통합하는 방법이다.
- 메세지 큐를 이용해 간접적으로 통합하는 방법도 있다.
    - 이때 메세지 큐에 담을 데이터 구조를 협의해야 하며, 큐를 제공하는 쪽에서 데이터 구조를 결정한다.
    - 큐를 추천 시스템에서 제공할 경우 큐를 통해 메시지를 추천 시스템에 전달하는 방식이 된다.

## 9.5 바운디드 컨텍스트 간 관계

### 1. REST API를 제공, 호출하는 관계

- API를 사용하는 바운디드 컨텍스트는 API를 제공하는 바운디드 컨텍스트에 의존하게 된다.
    
    <img width="1178" height="282" alt="Image" src="https://github.com/user-attachments/assets/21278999-de42-42b3-8ee3-230dfcf8578d" />
    
    - REST API의 인터페이스가 바뀌면 호출하는 쪽의 코드도 바뀌게 된다. → 커뮤니케이션 ↑
- 상류 컴포넌트는 보통 하류 컴포넌트가 사용할 수 있는 통신 프로토콜을 정의하고 이를 공개한다. 이를 **공개 호스트 서비스**라고 한다.
    - ex) REST API, 프로토콜 버퍼
- 하류 컴포넌트는 상류 서비스의 모델이 자신의 도메인 모델에 영향을 주지 않도록 보호해 주는 완충 지대를 만들어야 한다.
    
    <img width="1195" height="810" alt="Image" src="https://github.com/user-attachments/assets/0afa3b6b-c2e9-4b67-a4df-7f2da09726ca" />
    
    - 위 그림에서 RecSystemClient는 외부 시스템의 도메인 모델이 내 도메인 모델을 침범하지 않도록 막아주는 역할을 한다. ⇒ 안티코럽션 계층

### 2. 두 바운디드 컨텍스트가 같은 모델을 공유

- 두 팀이 공유하는 모델을 공유 커널이라고 한다.
- 중복을 줄여준다는 장점이 있다.
- 하지만 임의로 모델을 변경하면 안되며, 두 팀이 밀접한 관계를 유지해야 한다.
    - 밀접한 관계를 형성할 수 없다면 개발이 지연되고 정체되는 문제가 발생한다.

### 3. 독립 방식

- 서로 통합하지 않는 방식으로, 서로 독립적으로 모델을 발전시킨다.
- 두 바운디드 컨텍스트 간의 통합은 수동으로 이루어진다.
    
    <img width="1115" height="238" alt="Image" src="https://github.com/user-attachments/assets/c26b7a53-78a5-46bf-aa68-4fcf0fd8a5e6" />
    
- 규모가 커질수록 수동 통합에는 한계가 있으므로, 규모가 커지기 시작하면 두 바운디드 컨텍스트를 통합해야 한다.
- 혹은 두 바운디드 컨텍스트를 통합해 주는 별도의 시스템을 만드는 것도 방법

## 9.6 컨텍스트 맵

- 개별 바운디드 컨텍스트에 매몰되면 전체를 보지 못할 때가 있다.
- 이때 바운디드 컨텍스트 간의 관계를 표시한 컨텍스트 맵을 활용하면 된다.

<img width="1072" height="663" alt="Image" src="https://github.com/user-attachments/assets/952984c0-5bd6-451e-ac69-456fa30e331e" />

- 시스템의 전체 구조를 보여준다.